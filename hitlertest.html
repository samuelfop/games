<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Hitler - Print & Play Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Germania+One&family=Roboto+Mono:wght@400;700&display=swap');

        :root {
            --liberal: #65aadd; 
            --fascist: #d64d4d;
            --bg: #2b2b2b;
            --paper: #f4e4bc;
            --text: #333;
        }
        
        body { 
            font-family: 'Roboto Mono', monospace; 
            background: var(--bg); 
            color: #eee; 
            text-align: center; 
            margin: 0; 
            padding: 20px; 
        }
        
        h1, h2, h3 { font-family: 'Germania One', cursive; letter-spacing: 1px; }
        .hidden { display: none !important; }

        /* --- THE PRETTY IMAGES CSS --- */
        
        /* The Logo Styling */
        #game-logo {
            max-width: 90%;
            height: auto;
            margin-bottom: 20px;
            filter: drop-shadow(0px 0px 10px rgba(0,0,0,0.5));
        }

        /* The Board Styling */
        .board-container {
            position: relative;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 100%;
            max-width: 800px;
            height: 250px; /* Adjust based on your screenshot aspect ratio */
            margin: 20px auto;
            border-radius: 5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        
        /* Invisible slots that overlay the board image */
        .slot-overlay-container {
            display: flex;
            justify-content: center; /* Adjust to align with image */
            padding-top: 65px; /* Push down to match the artwork lines */
            gap: 12px; /* Gap between cards on the board image */
            height: 100%;
        }

        .policy-card { 
            width: 90px; height: 130px; 
            display: inline-block; 
            background-size: cover;
            border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.6);
            transition: transform 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        /* Empty slot marker (if you want to see where cards go) */
        .empty-slot {
            width: 90px; height: 130px;
            border: 2px dashed rgba(0,0,0,0.3);
            border-radius: 4px;
        }

        /* --- UI ELEMENTS --- */
        
        .card { 
            background: var(--paper); 
            color: var(--text);
            padding: 15px; 
            margin: 10px; 
            display: inline-block; 
            border-radius: 2px; 
            box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
        }
        
        .btn { 
            padding: 15px 25px; 
            font-size: 1.1em; 
            font-family: 'Germania One', cursive;
            cursor: pointer; 
            background: #555; 
            color: white; 
            border: 1px solid #777; 
            margin: 8px; 
            box-shadow: 2px 2px 0px #222;
        }
        .btn:active { transform: translate(2px, 2px); box-shadow: none; }
        .btn-ja { background: var(--paper); color: var(--fascist); border: 4px solid var(--fascist); font-size: 1.5em; transform: rotate(-2deg); }
        .btn-nein { background: var(--paper); color: var(--text); border: 4px solid var(--text); font-size: 1.5em; transform: rotate(2deg); }
        .btn-action { background: #d4af37; color: black; border: 2px solid #8a7018; }
        
        #notification-area { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 600px;
            background: #fff; color: #000; border: 4px solid #000;
            padding: 15px; font-weight: bold; font-size: 1.2em;
            display: none; z-index: 1000; 
            box-shadow: 10px 10px 0px rgba(0,0,0,0.8);
            font-family: 'Germania One', cursive;
        }
        
        .secret-role { 
            padding: 20px; border: 10px solid; 
            display: none; margin: 20px auto; max-width: 320px; 
            background: var(--paper); color: #222;
        }
        .role-liberal { border-color: var(--liberal); }
        .role-fascist { border-color: var(--fascist); }
    </style>
</head>
<body>

    <div id="notification-area"></div>

    <div id="setup-screen">
        <img id="game-logo" src="" alt="Secret Hitler">
        
        <div class="card">
            <h3>IDENTIFICATION</h3>
            <input type="text" id="playerName" placeholder="Enter Your Name" style="padding:10px; font-family:inherit;">
            <br><br>
            <button class="btn" onclick="createGame()">Create Game (Host)</button>
            <button class="btn" onclick="joinGame()">Join Game (Player)</button>
        </div>
    </div>

    <div id="host-view" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; padding: 0 20px;">
            <h2 style="font-family: sans-serif;">CODE: <span id="display-game-code" style="color:gold;"></span></h2>
            <h2 id="game-status" style="color: #f4e4bc;">Status: Waiting...</h2>
        </div>
        
        <div id="lobby-list" style="color: #aaa; margin-bottom: 20px;"></div>
        <button id="start-btn" class="btn hidden" onclick="startGame()" style="background: #d64d4d; font-size: 1.5em;">BEGIN GAME</button>
        
        <div id="game-board" class="hidden">
            
            <div id="lib-board-bg" class="board-container">
                <div id="lib-track" class="slot-overlay-container"></div>
            </div>

            <div id="fas-board-bg" class="board-container">
                <div id="fas-track" class="slot-overlay-container"></div>
            </div>
            
            <div style="display: flex; justify-content: center; gap: 40px; margin-top: 20px; font-size: 1.1em;">
                <div class="card" style="margin:0;">
                    <span style="font-weight:bold;">TRACKER</span><br>
                    <span id="tracker-count" style="color:red; font-size:1.5em;">0</span> / 3
                </div>
                <div class="card" style="margin:0;">
                    <span style="font-weight:bold;">DECK</span><br>
                    <span id="deck-count" style="font-size:1.5em;">--</span>
                </div>
            </div>
            <div id="government-display" style="margin-top: 30px; font-size: 1.4em; color: #f4e4bc;"></div>
        </div>
    </div>

    <div id="player-view" class="hidden">
        <h2 id="my-name-display" style="text-transform: uppercase; color: #f4e4bc;">PLAYER</h2>
        <button class="btn" onclick="toggleRole()">open/close secret role</button>
        
        <div id="my-role-card" class="secret-role">
            <h1 id="role-text" style="font-size: 2.5em; margin: 10px 0;">ROLE</h1>
            <p id="role-flavor" style="font-style: italic; font-size: 0.9em;"></p>
            <hr style="border: 1px dashed #333;">
            <p id="teammates-info" style="font-weight: bold; font-size: 0.9em;"></p>
        </div>

        <div id="player-action-area" style="margin-top: 30px;">
            <div id="instruction-card" class="card" style="width: 90%; max-width: 400px; display: none;">
                <h3 id="player-instruction-title" style="margin:0; border-bottom:1px solid #333; padding-bottom:5px;">INSTRUCTION</h3>
                <p id="player-instruction-body" style="font-size: 1.1em;"></p>
            </div>
            <div id="controls" style="display: flex; flex-direction: column; align-items: center; margin-top: 15px;"></div>
            <p id="wait-message" style="color: #888; font-style: italic;">Waiting for the government...</p>
        </div>
    </div>

    <script>
        // --- !!! PASTE YOUR IMAGE LINKS HERE !!! ---
const ASSETS = {
    logo: "./logo.png",
    lib_policy: "./liberal.png",
    fas_policy: "./fascist.png",
    lib_board: "./libboard.",
    
    // CHANGE: Split the fascist board into 3 different images
    fas_board_5_6: ".\fas56.png", // Powers: Peek, Kill, Kill
    fas_board_7_8: ".\fas78.png", // Powers: Investigate, Special Election, Kill, Kill
    fas_board_9_10: ".\fas910.png" // Powers: Investigate, Investigate, Special Election, Kill, Kill
};

        // --- APPLY ASSETS ---
        document.getElementById('game-logo').src = ASSETS.logo;
        document.getElementById('lib-board-bg').style.backgroundImage = `url('${ASSETS.lib_board}')`;
        // 1. Get player count
const pCount = Object.keys(localState.players || {}).length || 5;

// 2. Determine which board image to use
let fasImage = ASSETS.fas_board_5_6; // Default
if (pCount >= 7 && pCount <= 8) fasImage = ASSETS.fas_board_7_8;
if (pCount >= 9) fasImage = ASSETS.fas_board_9_10;

// 3. Apply the correct image
document.getElementById('fas-board-bg').style.backgroundImage = `url('${fasImage}')`;

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBcn5aaeBbPfWRNm_xremdSHFuI6S4_VCs",
            authDomain: "seceret-4c9b8.firebaseapp.com",
            databaseURL: "https://seceret-4c9b8-default-rtdb.firebaseio.com",
            projectId: "seceret-4c9b8",
            storageBucket: "seceret-4c9b8.firebasestorage.app",
            messagingSenderId: "627949762930",
            appId: "1:627949762930:web:3cc0b43c5166d73c5705eb"
        };

        if (typeof firebase === 'undefined') alert("Error: Internet required.");
        else if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let gameId = null, myId = null, isHost = false, localState = {};

        // Power Boards [cite: 215]
        const BOARDS = {
            5: [null, null, 'Policy Peek', 'Execution', 'Execution', null],
            6: [null, null, 'Policy Peek', 'Execution', 'Execution', null],
            7: [null, 'Investigate Loyalty', 'Special Election', 'Execution', 'Execution', null],
            8: [null, 'Investigate Loyalty', 'Special Election', 'Execution', 'Execution', null],
            9: ['Investigate Loyalty', 'Investigate Loyalty', 'Special Election', 'Execution', 'Execution', null],
            10: ['Investigate Loyalty', 'Investigate Loyalty', 'Special Election', 'Execution', 'Execution', null]
        };

        function createGame() {
            isHost = true;
            gameId = Math.floor(Math.random() * 9000 + 1000).toString();
            db.ref(gameId).set({
                state: 'LOBBY', libPolicies: 0, fasPolicies: 0, electionTracker: 0, players: {},
                deck: shuffleDeck(), discard: [], president: null, chancellor: null, 
                lastChancellor: null, lastPresident: null, votes: {}, legislativeHand: [], 
                executiveAction: null, notification: "Waiting for players..."
            });
            setupView('host-view');
            document.getElementById('display-game-code').innerText = gameId;
            db.ref(gameId).on('value', snap => { localState = snap.val(); if(localState) renderHost(); });
            setInterval(hostGameLoop, 1000);
        }

        function joinGame() {
            const name = document.getElementById('playerName').value;
            if(!name) return alert("Name required");
            gameId = prompt("Game Code:");
            if(!gameId) return;
            myId = 'player_' + Date.now();
            db.ref(gameId + '/players/' + myId).set({ name: name, role: null, party: null, id: myId, alive: true });
            setupView('player-view');
            document.getElementById('my-name-display').innerText = name;
            db.ref(gameId).on('value', snap => { localState = snap.val(); if(localState) renderPlayer(); });
        }

        function startGame() {
            if(!localState.players) return;
            const keys = Object.keys(localState.players);
            if(keys.length < 5) return alert("Need 5+ players");
            
            let roles = ['HITLER'], numFas = 1;
            if(keys.length >= 7) numFas = 2;
            if(keys.length >= 9) numFas = 3;
            for(let i=0; i<numFas; i++) roles.push('FASCIST');
            while(roles.length < keys.length) roles.push('LIBERAL');
            roles.sort(() => Math.random() - .5);

            const updates = { state: 'NOMINATION', president: keys[Math.floor(Math.random()*keys.length)], presidentOrder: keys, notification: "Game Started" };
            keys.forEach((k, i) => {
                updates[`players/${k}/role`] = roles[i];
                updates[`players/${k}/party`] = (roles[i] === 'LIBERAL') ? 'LIBERAL' : 'FASCIST';
            });
            db.ref(gameId).update(updates);
        }

        function hostGameLoop() {
            if(!isHost || !localState || localState.state !== 'VOTING') return;
            const living = Object.values(localState.players).filter(p => p.alive);
            const votes = localState.votes || {};
            if(Object.keys(votes).length >= living.length && living.length > 0) evaluateVote(votes);
        }

        function evaluateVote(votes) {
            let jas = Object.values(votes).filter(v => v === 'ja').length;
            let neins = Object.values(votes).filter(v => v === 'nein').length;
            if(jas > neins) {
                if(localState.fasPolicies >= 3 && getRole(localState.chancellor) === 'HITLER') return endGame("FASCIST VICTORY: Hitler Elected!");
                let deck = localState.deck || [];
                if(deck.length < 3) deck = shuffleDeck();
                db.ref(gameId).update({ state: 'LEGISLATIVE_PRES', legislativeHand: deck.slice(0,3), deck: deck.slice(3), votes: {}, electionTracker: 0 });
            } else advanceTurn(true);
        }

        function advanceTurn(failed=false) {
            let updates = {};
            if(failed) {
                let t = (localState.electionTracker || 0) + 1;
                updates.electionTracker = t;
                if(t >= 3) {
                    const top = localState.deck[0];
                    updates.deck = localState.deck.slice(1);
                    updates.electionTracker = 0;
                    updates.libPolicies = localState.libPolicies + (top==='LIBERAL'?1:0);
                    updates.fasPolicies = localState.fasPolicies + (top==='FASCIST'?1:0);
                    updates.lastChancellor = null; updates.lastPresident = null;
                    updates.notification = "CHAOS! Policy Enacted.";
                    if(updates.libPolicies >= 5) return endGame("LIBERAL WIN");
                    if(updates.fasPolicies >= 6) return endGame("FASCIST WIN");
                } else updates.notification = "Vote Failed.";
            } else {
                updates.lastPresident = localState.president;
                updates.lastChancellor = localState.chancellor;
            }

            let nextPres;
            if(localState.specialElectionReturn) { nextPres = localState.specialElectionReturn; updates.specialElectionReturn = null; }
            else {
                const order = localState.presidentOrder;
                let idx = (order.indexOf(localState.president) + 1) % order.length;
                while(!localState.players[order[idx]].alive) idx = (idx + 1) % order.length;
                nextPres = order[idx];
            }
            updates.state = 'NOMINATION'; updates.president = nextPres; updates.chancellor = null; updates.votes = {}; updates.legislativeHand = [];
            db.ref(gameId).update(updates);
        }

        function enactPolicy(pol) {
            let updates = { legislativeHand: [] }, newLib = localState.libPolicies, newFas = localState.fasPolicies;
            if(pol === 'LIBERAL') {
                updates.libPolicies = ++newLib;
                if(newLib >= 5) return endGame("LIBERALS WIN");
                db.ref(gameId).update(updates).then(() => advanceTurn());
            } else {
                updates.fasPolicies = ++newFas;
                if(newFas >= 6) return endGame("FASCISTS WIN");
                const power = (BOARDS[Object.keys(localState.players).length] || BOARDS[5])[newFas - 1];
                if(power) {
                    updates.state = 'EXECUTIVE_ACTION'; updates.executiveAction = power;
                    updates.notification = `POWER: ${power}`;
                    db.ref(gameId).update(updates);
                } else db.ref(gameId).update(updates).then(() => advanceTurn());
            }
        }

        // --- CLIENT ACTIONS ---
        function handleVote(v) { db.ref(gameId+'/votes/'+myId).set(v); }
        function nominate(id) { 
            const pCount = Object.values(localState.players).filter(p => p.alive).length;
            if(id === localState.lastChancellor || (pCount > 5 && id === localState.lastPresident)) return alert("Term Limited");
            db.ref(gameId).update({ chancellor: id, state: 'VOTING', notification: "VOTE NOW" });
        }
        function legislationDiscard(i) {
            let h = [...localState.legislativeHand]; h.splice(i, 1);
            if(localState.state === 'LEGISLATIVE_PRES') db.ref(gameId).update({ state: 'LEGISLATIVE_CHAN', legislativeHand: h });
            else enactPolicy(h[0]);
        }
        function proposeVeto() { db.ref(gameId).update({ state: 'VETO_CONSENT', notification: "Veto Proposed" }); }
        function answerVeto(agree) { agree ? advanceTurn(true) : db.ref(gameId).update({ state: 'LEGISLATIVE_CHAN' }); }
        
        function performExecutiveAction(tid) {
            const act = localState.executiveAction;
            let up = { state: 'NOMINATION', executiveAction: null };
            if(act.includes('Investigate')) alert(`Party: ${localState.players[tid].party}`);
            else if(act.includes('Execution')) {
                if(getRole(tid) === 'HITLER') return endGame("HITLER DIED. LIBERALS WIN.");
                up[`players/${tid}/alive`] = false;
            } else if(act.includes('Special')) {
                up.state = 'NOMINATION'; up.president = tid; up.chancellor = null;
                up.specialElectionReturn = getNextPresidentIndex();
                db.ref(gameId).update(up); return;
            }
            db.ref(gameId).update(up).then(() => advanceTurn());
        }
        function peekPolicy() { alert(`Top 3: ${localState.deck.slice(0,3).join(', ')}`); db.ref(gameId).update({state:'NOMINATION', executiveAction:null}).then(()=>advanceTurn()); }

        // --- RENDER ---
        function renderHost() {
            if(localState.notification) showNotification(localState.notification);
            if(localState.players) document.getElementById('lobby-list').innerHTML = Object.values(localState.players).map(p => p.name).join(' â€¢ ');
            
            // RENDER VISUAL BOARD
            renderVisualTrack('lib-track', 5, localState.libPolicies, ASSETS.lib_policy);
            renderVisualTrack('fas-track', 6, localState.fasPolicies, ASSETS.fas_policy);
            
            document.getElementById('tracker-count').innerText = localState.electionTracker;
            document.getElementById('deck-count').innerText = localState.deck ? localState.deck.length : 0;
            if(localState.president) document.getElementById('government-display').innerText = `Pres: ${getName(localState.president)} | Chan: ${getName(localState.chancellor)}`;
        }

        function renderVisualTrack(id, max, curr, imgUrl) {
            const div = document.getElementById(id);
            div.innerHTML = '';
            for(let i=0; i<max; i++) {
                let d = document.createElement('div');
                if(i < curr) {
                    d.className = 'policy-card';
                    d.style.backgroundImage = `url('${imgUrl}')`;
                } else {
                    d.className = 'empty-slot';
                }
                div.appendChild(d);
            }
        }

        function renderPlayer() {
            if(!localState.players || !localState.players[myId]) return;
            const me = localState.players[myId];
            const amPres = localState.president === myId, amChan = localState.chancellor === myId;
            const controls = document.getElementById('controls');
            const inst = document.getElementById('instruction-card');
            
            document.getElementById('role-text').innerText = me.role;
            document.getElementById('role-flavor').innerText = me.role === 'LIBERAL' ? "Sustain the government." : "Sabotage.";
            document.getElementById('my-role-card').className = 'secret-role ' + (me.role === 'LIBERAL'?'role-liberal':'role-fascist');
            
            // Teammates
            const all = Object.values(localState.players);
            if(me.role === 'FASCIST') document.getElementById('teammates-info').innerText = "Fascists: " + all.filter(p=>p.role==='FASCIST'||p.role==='HITLER').map(p=>p.name).join(', ');
            else if(me.role === 'HITLER' && all.length <= 6) document.getElementById('teammates-info').innerText = "Teammate: " + all.filter(p=>p.role==='FASCIST').map(p=>p.name).join(', ');
            else document.getElementById('teammates-info').innerText = "Trust no one.";

            controls.innerHTML = ''; inst.style.display = 'none';
            document.getElementById('wait-message').style.display = 'block';

            if(!me.alive) { document.getElementById('wait-message').innerText = "EXECUTED"; return; }

            if(localState.state === 'NOMINATION' && amPres) {
                renderControls("Select Chancellor", Object.values(localState.players).filter(p=>p.id!==myId && p.alive).map(p => ({txt: p.name, fn: `nominate('${p.id}')`})), controls, inst);
            } else if(localState.state === 'VOTING' && (!localState.votes || !localState.votes[myId])) {
                renderControls("Vote", [{txt:"Ja!", fn:"handleVote('ja')", cls:"btn-ja"}, {txt:"Nein", fn:"handleVote('nein')", cls:"btn-nein"}], controls, inst);
            } else if(localState.state === 'LEGISLATIVE_PRES' && amPres) {
                renderControls("Discard 1 Policy", localState.legislativeHand.map((c,i) => ({txt: c, fn: `legislationDiscard(${i})`, cls: c==='LIBERAL'?'btn-ja':'btn-nein'})), controls, inst);
            } else if(localState.state === 'LEGISLATIVE_CHAN' && amChan) {
                let opts = localState.legislativeHand.map((c,i) => ({txt: c, fn: `legislationDiscard(${i})`, cls: c==='LIBERAL'?'btn-ja':'btn-nein'}));
                if(localState.fasPolicies === 5) opts.push({txt: "VETO", fn: "proposeVeto()", cls: "btn-action"});
                renderControls("Discard 1 Policy", opts, controls, inst);
            } else if(localState.state === 'VETO_CONSENT' && amPres) {
                renderControls("Consent to Veto?", [{txt:"Agree", fn:"answerVeto(true)"}, {txt:"Reject", fn:"answerVeto(false)"}], controls, inst);
            } else if(localState.state === 'EXECUTIVE_ACTION' && amPres) {
                const act = localState.executiveAction;
                if(act.includes('Peek')) renderControls("Power: Peek", [{txt:"Peek", fn:"peekPolicy()", cls:"btn-action"}], controls, inst);
                else renderControls(`Power: ${act}`, Object.values(localState.players).filter(p=>p.id!==myId && p.alive).map(p => ({txt: p.name, fn: `performExecutiveAction('${p.id}')`, cls:"btn-action"})), controls, inst);
            }
        }

        function renderControls(title, buttons, container, card) {
            document.getElementById('wait-message').style.display = 'none';
            card.style.display = 'block';
            document.getElementById('player-instruction-title').innerText = title;
            document.getElementById('player-instruction-body').innerText = "";
            buttons.forEach(b => {
                container.innerHTML += `<button class="btn ${b.cls||''}" onclick="${b.fn}">${b.txt}</button>`;
            });
        }

        // Utils
        function setupView(view) { document.getElementById('setup-screen').classList.add('hidden'); document.getElementById(view).classList.remove('hidden'); }
        function shuffleDeck() { return Array(6).fill('LIBERAL').concat(Array(11).fill('FASCIST')).sort(()=>Math.random()-.5); }
        function getRole(id) { return localState.players[id]?.role; }
        function getName(id) { return localState.players[id]?.name || 'Unknown'; }
        function getNextPresidentIndex() { 
            const o = localState.presidentOrder; let i = (o.indexOf(localState.president)+1)%o.length;
            while(!localState.players[o[i]].alive) i=(i+1)%o.length; return localState.players[o[i]].id;
        }
        function showNotification(msg) { const e = document.getElementById('notification-area'); e.innerText=msg; e.style.display='block'; setTimeout(()=>e.style.display='none', 4000); }
        function endGame(msg) { db.ref(gameId).update({state:'GAMEOVER', notification:msg}); alert(msg); }
        function toggleRole() { const e=document.getElementById('my-role-card'); e.style.display=(e.style.display==='block'?'none':'block'); }
    </script>
</body>
</html>
